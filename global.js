function hexToRgb(e){return[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)]}function initColorGrid(){const e=document.getElementById("colorGrid"),t=document.createElement("input");t.type="color",t.hidden=!0,document.body.appendChild(t),e.innerHTML="",["#000000","#FFFFFF","#808080","#0000FF","#008000","#FF8C00","#FFFF00","#FF0000","#FFC0CB","#800080","#A52A2A","#4D96FF","#7CFC00","#FF9966",...isIOS()?[]:["diy"]].forEach(o=>{const n=document.createElement("div");n.className="color-item","diy"===o?(n.textContent="DIY",n.style.border="2px dashed #999",n.style.color="#666",n.addEventListener("click",()=>{t.click()})):(n.style.backgroundColor=o,n.addEventListener("click",()=>handleColorSelect(o))),n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.fontWeight="bold",n.style.cursor="pointer",e.appendChild(n)}),t.addEventListener("input",t=>{const o=t.target.value;handleColorSelect(o);const n=[...e.children].find(e=>"DIY"===e.textContent);n&&(n.style.backgroundColor=o,n.style.color=getContrastColor(o))})}function handleColorSelect(e){currentColor=e,document.getElementById("previewBox").style.backgroundColor=e,document.documentElement.style.setProperty("--current-color",e);const t=document.getElementById("colorPicker");t&&(t.value=e)}function getContrastColor(e){return.299*parseInt(e.slice(1,3),16)+.587*parseInt(e.slice(3,5),16)+.114*parseInt(e.slice(5,7),16)>150?"#000":"#fff"}function isIOS(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}function initFullscreen(){const e=document.getElementById("previewBox"),t=document.querySelector(".fullscreen-tip"),o=document.getElementById("fullscreenOverlay"),n=document.getElementById("zoomIcon");if(isIOS()){let t=null;const o=()=>(t||((t=document.createElement("div")).style.cssText="\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          z-index: 9999;\n          touch-action: none;\n        ",t.addEventListener("click",()=>{document.body.removeChild(t),n.style.display="block"})),t);return void e.addEventListener("click",()=>{const e=o();e.style.backgroundColor=currentColor,document.body.appendChild(e),n.style.display="none"})}const c=Element.prototype.requestFullscreen||Element.prototype.webkitRequestFullscreen,l=document.exitFullscreen||document.webkitExitFullscreen,r=()=>document.fullscreenElement||document.webkitFullscreenElement;e.addEventListener("click",()=>{if(!r()){o.style.backgroundColor=currentColor,e.style.backgroundColor=currentColor,document.documentElement.style.backgroundColor=currentColor;const t=t=>{const o=hexToRgb(t);e.style.cssText=`\n      background: ${t} !important;\n      background-color: rgb(${o[0]}, ${o[1]}, ${o[2]}) !important;\n      --current-color: ${t} !important;\n    `};e.addEventListener("click",()=>{r()||(t(currentColor),navigator.userAgent.includes("Firefox")&&(document.documentElement.style.backgroundColor=currentColor,document.body.style.backgroundColor=currentColor),c.call(e).then(()=>{t(currentColor)}))}),c.call(e).then(()=>{e.style.cssText=`background: ${currentColor} !important`}),o.style.display="block",o.style.backgroundColor=currentColor,c.call(e).then(()=>{document.querySelectorAll("body > *:not(#previewBox)").forEach(e=>{e.classList.add("fullscreen-hide")})}).catch(e=>{console.error("全屏失败:",e),o.style.display="none"})}});const d=()=>{r()?(t.style.display="block",o.style.display="block"):(t.style.display="none",o.style.display="none",document.querySelectorAll(".fullscreen-hide").forEach(e=>{e.classList.remove("fullscreen-hide")}))};document.addEventListener("fullscreenchange",d),document.addEventListener("webkitfullscreenchange",d),document.addEventListener("keydown",e=>{"Escape"===e.key&&r()&&l.call(document)}),document.addEventListener("click",()=>{r()&&l.call(document)})}function initResolution(){const e=()=>{const[e,t]=document.getElementById("resolutionDropdown").value.split(",");document.getElementById("widthInput").value=e,document.getElementById("heightInput").value=t};document.getElementById("resolutionDropdown").addEventListener("change",e),e()}function initDownload(){document.getElementById("downloadBtn").addEventListener("click",()=>{const e=document.getElementById("widthInput").value,t=document.getElementById("heightInput").value,o=document.getElementById("colorPicker").value,n=document.createElement("canvas");n.width=e,n.height=t;const c=n.getContext("2d");c.fillStyle=o,c.fillRect(0,0,e,t);const l=document.createElement("a");l.download=`PantallaBlanca.com_${e}x${t}_${o.replace("#","")}.png`,l.href=n.toDataURL(),l.click()})}function toggleLanguageMenu(){document.getElementById("language-menu").classList.toggle("show")}function hideLanguageMenu(){document.getElementById("language-menu").classList.toggle("hide")}function copyToClipboard(e){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{showToast("OK")}).catch(()=>{fallbackCopyText(e)}):fallbackCopyText(e)}function fallbackCopyText(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{showToast(document.execCommand("copy")?"OK":"Please copy manually!")}catch(e){showToast("Please copy manually!")}document.body.removeChild(t)}function showToast(e){const t=document.getElementById("toast");t.textContent=e,t.style.display="block",setTimeout(()=>{t.style.display="none"},2e3)}function copyText(e){copyToClipboard(document.getElementById(e).textContent)}function copyCode(e){copyToClipboard(e)}function toggleShareDialog(){document.getElementById("share-dialog").classList.toggle("show")}function shareToTwitter(){const e=encodeURIComponent(window.location.href),t=encodeURIComponent(share_title);window.open(`https://twitter.com/intent/tweet?url=${e}&text=${t}`,"_blank")}function shareToFacebook(){const e=encodeURIComponent(window.location.href);window.open(`https://www.facebook.com/sharer/sharer.php?u=${e}`,"_blank")}function shareToLine(){const e=encodeURIComponent(window.location.href),t=encodeURIComponent(share_title);window.open(`https://social-plugins.line.me/lineit/share?url=${e}&text=${t}`,"_blank")}function shareToWhatsApp(){const e=encodeURIComponent(window.location.href),t=encodeURIComponent(share_title);window.open(`https://api.whatsapp.com/send?text=${t}%20${e}`,"_blank")}function shareToInstagram(){copyUrl()}function shareToSnapchat(){const e=encodeURIComponent(window.location.href),t=encodeURIComponent(share_title);window.open(`https://www.snapchat.com/scan?attachmentUrl=${e}&text=${t}`,"_blank")}function shareToGoogle(){const e=encodeURIComponent(window.location.href);window.open(`https://plus.google.com/share?url=${e}`,"_blank")}function shareToTelegram(){const e=encodeURIComponent(window.location.href),t=encodeURIComponent(share_title);window.open(`https://t.me/share/url?url=${e}&text=${t}`,"_blank")}function shareByEmail(){const e=window.location.href,t=encodeURIComponent(share_title),o=encodeURIComponent(`${found_message}: ${e}`);window.location.href=`mailto:?subject=${t}&body=${o}`}function copyUrl(){const e=window.location.href;navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{showToast("OK")}).catch(()=>{fallbackCopyUrl(e)}):fallbackCopyUrl(e)}function fallbackCopyUrl(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{showToast(document.execCommand("copy")?"OK":"copy failed")}catch(e){showToast("copy failed")}finally{document.body.removeChild(t)}}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function toggleBackToTop(){const e=document.getElementById("back-to-top"),t=window.innerHeight,o=document.documentElement.scrollHeight,n=document.documentElement.scrollTop||document.body.scrollTop;o>t&&n>t/2?e.classList.add("show"):e.classList.remove("show")}function isPc(){var e=navigator.userAgent||navigator.vendor||window.opera;return!/windows phone|ipad|iphone|ipod|android|blackberry|mini|windows ce|palm/i.test(e)}function isNearBottom(e=240){const t=document.documentElement.scrollHeight;return(window.scrollY||document.documentElement.scrollTop)+window.innerHeight+e>=t}function loadJS(e,t){const o=document.createElement("script");o.src=e,o.onload=t,o.onerror=function(){console.error("JS load failed")},document.body.appendChild(o)}window.addEventListener("scroll",toggleBackToTop);